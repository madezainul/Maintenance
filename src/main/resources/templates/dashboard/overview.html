<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org" xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
	layout:decorate="~{layouts/dashboard}">

<head>
	<title>Dashboard</title>
</head>

<body>
	<div layout:fragment="content">
		<div class="panel-header bg-primary-gradient">
			<div class="page-inner py-5">
				<div class="d-flex align-items-left align-items-md-center flex-column flex-md-row">
					<div>
						<h2 class="text-white pb-2 fw-bold">Dashboard</h2>
						<h5 class="text-white op-7 mb-2">Maintenance Overview</h5>
					</div>
					<div class="ml-md-auto py-2 py-md-0">
						<a href="#" class="btn btn-info btn-round" id="generateReportBtn">
							<i class="fas fa-file-pdf"></i> Generate Report
						</a>
					</div>
				</div>
			</div>
		</div>
		<div class="page-inner mt--5">

			<div class="row">
				<div class="col-md-12">
					<div class="card full-height">
						<div class="card-header">
    <div class="d-flex justify-content-between align-items-center">
        <h4 class="card-title">Overall Complaint</h4>
        <form id="complaint-stats-form" class="form-inline">
            <div class="input-group input-daterange">
                <input type="datetime-local" class="form-control form-control-sm"
                    id="complaint-stats-from" name="from">
                <div class="input-group-prepend input-group-append">
                    <span class="input-group-text">to</span>
                </div>
                <input type="datetime-local" class="form-control form-control-sm"
                    id="complaint-stats-to" name="to">
                <div class="input-group-append">
                    <button type="submit" class="btn btn-sm btn-primary ml-2">Apply</button>
                    <button type="button" class="btn btn-sm btn-secondary ml-1" id="complaint-stats-reset">Reset</button>
                </div>
            </div>
        </form>
    </div>
</div>
						<div class="card-body">
							<div class="row row-card-no-pd mb-0" style="box-shadow: none;">

								<!-- Total -->
								<div class="col-sm-6 col-md-3">
									<a href="#" class="text-decoration-none" data-status="">
										<div class="card card-stats card-primary card-round mt-1 cursor-pointer">
											<div class="card-body">
												<div class="row">
													<div class="col-5">
														<div class="icon-big text-center">
															<i class="fas fa-ticket-alt text-white"></i>
														</div>
													</div>
													<div class="col-7 col-stats">
														<div class="numbers">
															<p class="card-category">Total</p>
															<h4 class="card-title" id="complaint-stats-total">--</h4>
														</div>
													</div>
												</div>
											</div>
										</div>
									</a>
								</div>

								<!-- Pending -->
								<div class="col-sm-6 col-md-3">
									<a href="#" class="text-decoration-none" data-status="PENDING">
										<div class="card card-stats card-danger card-round mt-1 cursor-pointer">
											<div class="card-body">
												<div class="row">
													<div class="col-5">
														<div class="icon-big text-center">
															<i class="fas fa-clock text-white"></i>
														</div>
													</div>
													<div class="col-7 col-stats">
														<div class="numbers">
															<p class="card-category">Pending</p>
															<h4 class="card-title" id="complaint-stats-pending">--</h4>
														</div>
													</div>
												</div>
											</div>
										</div>
									</a>
								</div>

								<!-- Open -->
								<div class="col-sm-6 col-md-3">
									<a href="#" class="text-decoration-none" data-status="OPEN">
										<div class="card card-stats card-warning card-round mt-1 cursor-pointer">
											<div class="card-body">
												<div class="row">
													<div class="col-5">
														<div class="icon-big text-center">
															<i class="fas fa-folder-open text-white"></i>
														</div>
													</div>
													<div class="col-7 col-stats">
														<div class="numbers">
															<p class="card-category">Open</p>
															<h4 class="card-title" id="complaint-stats-open">--</h4>
														</div>
													</div>
												</div>
											</div>
										</div>
									</a>
								</div>

								<!-- Closed -->
								<div class="col-sm-6 col-md-3">
									<a href="#" class="text-decoration-none" data-status="CLOSED">
										<div class="card card-stats card-success card-round mt-1 cursor-pointer">
											<div class="card-body">
												<div class="row">
													<div class="col-5">
														<div class="icon-big text-center">
															<i class="fas fa-check-circle text-white"></i>
														</div>
													</div>
													<div class="col-7 col-stats">
														<div class="numbers">
															<p class="card-category">Closed</p>
															<h4 class="card-title" id="complaint-stats-closed">--</h4>
														</div>
													</div>
												</div>
											</div>
										</div>
									</a>
								</div>
							</div>
						</div>
					</div>
				</div>
			</div>

			<div class="row">
				<div class="col-md-12">
					<div class="card full-height">
						<div class="card-header">
							<div class="d-flex justify-content-between align-items-center">
								<h4 class="card-title">Complaint Chart</h4>

								<!-- Filter Dropdown - NOW ONLY HAS MONTHLY AND YEARLY -->
								<div class="dropdown">
									<button class="btn btn-sm btn-outline-secondary dropdown-toggle" type="button"
										id="complaintFilterDropdown" data-toggle="dropdown" aria-haspopup="true"
										aria-expanded="false">
										<i class="fas fa-filter"></i> Filters
									</button>
									<div class="dropdown-menu dropdown-menu-right p-3" style="width: 360px;"
										aria-labelledby="complaintFilterDropdown">
										<div class="form-group">
											<label for="complaint-from">Date Range</label>
											<div class="input-group input-daterange">
												<input type="date" class="form-control form-control-sm"
													id="complaint-from" required>
												<div class="input-group-prepend input-group-append">
													<span class="input-group-text">to</span>
												</div>
												<input type="date" class="form-control form-control-sm"
													id="complaint-to" required>
											</div>
										</div>

										<!-- REMOVE WEEKLY BUTTON — KEEP ONLY MONTHLY & YEARLY -->
										<div class="btn-group btn-group-sm d-flex mb-2">
											<!-- <button type="button" class="btn btn-outline-primary flex-fill" data-range="weekly">Weekly</button> -->
											<button type="button" class="btn btn-outline-primary flex-fill"
												data-range="monthly">Monthly</button>
											<button type="button" class="btn btn-outline-primary flex-fill"
												data-range="yearly">Yearly</button>
										</div>

										<!-- Year Selector (shown in Yearly) -->
										<div id="complaint-year-selector" style="display: none;" class="mt-2">
											<div class="form-group">
												<label for="complaint-year-select">Year</label>
												<select id="complaint-year-select"
													class="form-control form-control-sm"></select>
											</div>
										</div>

										<!-- Month Selector (shown ONLY in Monthly mode) -->
										<div id="complaint-month-selector" style="display: none;" class="mt-2">
											<div class="form-group">
												<label for="complaint-month-select">Month</label>
												<select id="complaint-month-select"
													class="form-control form-control-sm">
													<option value="">All Months</option>
													<option value="01">January</option>
													<option value="02">February</option>
													<option value="03">March</option>
													<option value="04">April</option>
													<option value="05">May</option>
													<option value="06">June</option>
													<option value="07">July</option>
													<option value="08">August</option>
													<option value="09">September</option>
													<option value="10">October</option>
													<option value="11">November</option>
													<option value="12">December</option>
												</select>
											</div>
										</div>

										<button id="apply-complaint-filters"
											class="btn btn-sm btn-primary btn-block mt-2">
											Apply Filters
										</button>
									</div>
								</div>
							</div>
						</div>

						<!-- WEEKLY NAVIGATION CONTAINER — ALWAYS VISIBLE (since it's the default view) -->
						<div id="weekly-nav" class="d-flex justify-content-center align-items-center py-2"
							style="border-top: 1px solid #eee; margin-top: -1px;">
							<button class="btn btn-sm btn-outline-primary mx-1" id="prevWeekBtn" title="Previous Week"
								disabled>
								<i class="fas fa-chevron-left"></i> Prev
							</button>
							<span class="text-muted small mx-2" id="weekRangeLabel">Week of Jan 1–7, 2024</span>
							<button class="btn btn-sm btn-outline-primary mx-1" id="nextWeekBtn" title="Next Week"
								disabled>
								Next <i class="fas fa-chevron-right"></i>
							</button>
						</div>

						<div class="card-body d-flex flex-column">
							<div class="chart-container flex-grow-1">
								<canvas id="complaint-bar-chart"></canvas>
							</div>
						</div>
					</div>
				</div>
			</div>

			<div class="row">
				<div class="col-md-8">
					<div class="card">
						<div class="card-header">
							<div class="card-head-row card-tools-still-right">
								<h4 class="card-title">Engineers Responsibility</h4>
								<div class="card-tools">
									<button class="btn btn-icon btn-link btn-primary btn-xs" id="prevEngineerBtn"
										title="Previous">
										<i class="fas fa-chevron-left"></i>
									</button>
									<button class="btn btn-icon btn-link btn-primary btn-xs" id="nextEngineerBtn"
										title="Next">
										<i class="fas fa-chevron-right"></i>
									</button>
									<button class="btn btn-icon btn-link btn-primary btn-xs" id="refreshEngineerBtn"
										title="Refresh">
										<i class="fa fa-sync-alt"></i>
									</button>
								</div>
							</div>
							<p class="card-category">Map of the distribution of engineers responsibility</p>
						</div>
						<div class="card-body">
							<div class="table-responsive table-hover table-sales">
								<table class="table table-bordered text-center">
									<thead class="bg-primary text-white">
										<tr>
											<th rowspan="3" class="align-middle">Engineer</th>
											<th id="openHeader" colspan="0" style="display:none;"></th>
											<th id="pendingHeader" colspan="0" style="display:none;"></th>
											<th id="closedHeader" colspan="0" style="display:none;"></th>
										</tr>
										<tr id="dayHeaders">
										</tr>
									</thead>
									<tbody id="engineerTableBody">
									</tbody>
								</table>
							</div>
						</div>
					</div>
				</div>

				<div class="col-md-4">
					<div class="card">
						<div class="card-header">
							<div class="card-head-row card-tools-still-right">
								<h4 class="card-title">Equipment</h4>
								<div class="card-tools">
									<button class="btn btn-icon btn-link btn-primary btn-xs"
										id="equipment-work-prev-btn" title="Previous">
										<i class="fas fa-chevron-up"></i>
									</button>
									<button class="btn btn-icon btn-link btn-primary btn-xs"
										id="equipment-work-next-btn" title="Next">
										<i class="fas fa-chevron-down"></i>
									</button>
									<button class="btn btn-icon btn-link btn-primary btn-xs"
										id="equipment-work-refresh-btn" title="Refresh">
										<i class="fa fa-sync-alt"></i>
									</button>
								</div>
							</div>
							<p class="card-category">Top Equipment by Resolution Time</p>
						</div>
						<div class="card-body pb-0" id="equipment-work-list-container">
						</div>
					</div>
				</div>
			</div>


			<div class="row">
				<div class="col-md-12">
					<div class="card full-height">
						<div class="card-header">
							<div class="d-flex justify-content-between align-items-center">
								<h4 class="card-title">Work Report Chart</h4>

								<!-- Dropdown Trigger Button -->
								<div class="dropdown">
									<button class="btn btn-sm btn-outline-secondary dropdown-toggle" type="button"
										id="chartFilterDropdown" data-toggle="dropdown" aria-haspopup="true"
										aria-expanded="false">
										<i class="fas fa-filter"></i> Filters
									</button>
									<div class="dropdown-menu dropdown-menu-right p-3" style="width: 360px;"
										aria-labelledby="chartFilterDropdown">

										<!-- Date Range -->
										<div class="form-group">
											<label for="wr-from">Date Range</label>
											<div class="input-group input-daterange">
												<input type="date" class="form-control form-control-sm" id="wr-from"
													required>
												<div class="input-group-prepend input-group-append">
													<span class="input-group-text">to</span>
												</div>
												<input type="date" class="form-control form-control-sm" id="wr-to"
													required>
											</div>
										</div>

										<!-- Equipment -->
										<div class="form-group">
											<label for="wr-equipment">Equipment</label>
											<select id="wr-equipment" class="form-control form-control-sm">
												<option value="">All Equipment</option>
											</select>
										</div>

										<!-- Quick Buttons -->
										<div class="btn-group btn-group-sm d-flex mb-2">
											<button type="button" class="btn btn-outline-primary flex-fill"
												data-range="weekly">Weekly</button>
											<button type="button" class="btn btn-outline-primary flex-fill"
												data-range="monthly">Monthly</button>
											<button type="button" class="btn btn-outline-primary flex-fill"
												data-range="yearly">Yearly</button>
										</div>

										<!-- Year Selector -->
										<div id="wr-year-selector" style="display: none;">
											<div class="form-group">
												<label for="wr-year-select">Year</label>
												<select id="wr-year-select"
													class="form-control form-control-sm"></select>
											</div>
										</div>

										<!-- Apply Button -->
										<button id="apply-filters-btn" class="btn btn-sm btn-primary btn-block mt-2">
											Apply Filters
										</button>
									</div>
								</div>
							</div>
						</div>

						<div class="card-body d-flex flex-column">
							<div class="chart-container flex-grow-1">
								<canvas id="wr-equipment-line-chart"></canvas>
							</div>
						</div>
					</div>
				</div>
			</div>

			<div class="row">
				<div class="col-md-12">
					<div class="card full-height">
						<div class="card-header">
							<div class="d-flex justify-content-between align-items-center">
								<h4 class="card-title">Breakdown Chart</h4>

								<!-- Filters Dropdown Button -->
								<div class="dropdown">
									<button class="btn btn-sm btn-outline-secondary dropdown-toggle" type="button"
										id="breakdownFilterDropdown" data-toggle="dropdown" aria-haspopup="true"
										aria-expanded="false">
										<i class="fas fa-filter"></i> Filters
									</button>
									<div class="dropdown-menu dropdown-menu-right p-3" style="width: 360px;"
										aria-labelledby="breakdownFilterDropdown">

										<!-- Date Range -->
										<div class="form-group">
											<label for="breakdown-from">Date Range</label>
											<div class="input-group input-daterange">
												<input type="date" class="form-control form-control-sm"
													id="breakdown-from" required>
												<div class="input-group-prepend input-group-append">
													<span class="input-group-text">to</span>
												</div>
												<input type="date" class="form-control form-control-sm"
													id="breakdown-to" required>
											</div>
										</div>

										<!-- Quick Buttons -->
										<div class="btn-group btn-group-sm d-flex mb-2">
											<button type="button" class="btn btn-outline-primary flex-fill"
												data-range="weekly">Weekly</button>
											<button type="button" class="btn btn-outline-primary flex-fill"
												data-range="monthly">Monthly</button>
											<button type="button" class="btn btn-outline-primary flex-fill"
												data-range="yearly">Yearly</button>
										</div>

										<!-- Year Selector -->
										<div id="breakdown-year-selector" style="display: none;">
											<div class="form-group">
												<label for="breakdown-year-select">Year</label>
												<select id="breakdown-year-select"
													class="form-control form-control-sm"></select>
											</div>
										</div>

										<!-- Apply Button -->
										<button id="apply-breakdown-filters"
											class="btn btn-sm btn-primary btn-block mt-2">
											Apply Filters
										</button>
									</div>
								</div>
							</div>
						</div>
						<div class="card-body d-flex flex-column">
							<div class="chart-container flex-grow-1">
								<canvas id="breakdown-line-chart"></canvas>
							</div>
						</div>
					</div>
				</div>
			</div>


		</div>

		<footer class="footer">
			<div class="container-fluid">
				<nav class="pull-left">
					<ul class="nav">
						<li class="nav-item">
							<a class="nav-link" href="https://www.themekita.com">
								ThemeKita
							</a>
						</li>
						<li class="nav-item">
							<a class="nav-link" href="#">
								Help
							</a>
						</li>
						<li class="nav-item">
							<a class="nav-link" href="#">
								Licenses
							</a>
						</li>
					</ul>
				</nav>
				<div class="copyright ml-auto">
					2018, made with <i class="fa fa-heart heart text-danger"></i> by <a
						href="https://www.themekita.com">ThemeKita</a>
				</div>
			</div>
		</footer>
	</div>

	<!-- Scripts Fragment -->
	<th:block layout:fragment="scripts">
		<script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
		<script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
		<script th:inline="javascript">
			/*<![CDATA[*/
			const baseUrl = /*[[${@environment.getProperty('server.servlet.context-path', '')}]]*/ '' || '';
			const apiEndpoint = baseUrl + '/api/dashboards/status-count';
			/*]]>*/
		</script>
		<script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/3.9.1/chart.min.js"></script>
		<script th:src="@{/assets/js/overview-chart.js}"></script>
		<script th:src="@{/assets/js/generate-report.js}"></script>
	</th:block>
</body>

</html>